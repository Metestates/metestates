(this.webpackJsonpmetestates=this.webpackJsonpmetestates||[]).push([[0],{55:function(t,e,n){},58:function(t,e,n){},59:function(t,e,n){"use strict";n.r(e);var r=n(29),a=n.n(r),i=n(36),c=n(3),u=n.n(c),s=n(46),o=n.n(s),l=(n(55),n(6)),d=n(32),f={ParcelPixelWidth:4,ParcelPixelMinWidth:4,ParcelPixelMaxWidth:80,ParcelBlockWidth:30,ParcelsPerQuery:900,Origin:{x:-100,y:100},PanningStep:1},h=function(){var t=c.useState({width:window.innerWidth,height:window.innerHeight}),e=Object(l.a)(t,2),n=e[0],r=e[1];return c.useEffect((function(){function t(){r({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[window.innerWidth,window.innerHeight]),n};function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return Math.max(e||-1/0,Math.min(t,n||1/0))}var v=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{delta:1},n=c.useState(t),r=Object(l.a)(n,2),a=r[0],i=r[1];return c.useEffect((function(){function t(t){var n=w(a+(t.deltaY<0?-1*e.delta:e.delta),e.minValue,e.maxValue);i(n)}return window.addEventListener("wheel",t),function(){window.removeEventListener("wheel",t)}}),[a,i]),a};var g,p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},e=c.useState(t),n=Object(l.a)(e,2),r=n[0],a=n[1];return c.useEffect((function(){function t(t){var e=f.PanningStep,n={x:0,y:0};switch(t.key){case"ArrowUp":n.y=e;break;case"ArrowDown":n.y=-e;break;case"ArrowLeft":n.x=-e;break;case"ArrowRight":n.x=e}a({x:r.x+n.x,y:r.y+n.y})}return window.addEventListener("keydown",t),function(){window.removeEventListener("keydown",t)}}),[r,a]),r},x=n(63),y=n(47),b=n(71),P=Object(b.a)(g||(g=Object(y.a)(["\n\tquery GET_PARCEL_BLOCK(\n\t\t$first: Int,\n\t\t$xGte: BigInt\n\t\t$xLt: BigInt\n\t\t$yLte: BigInt\n\t\t$yGt: BigInt\n\t) {\n\t\tparcels(\n\t\t\tfirst: $first,\n\t\t\twhere: { x_gte: $xGte, x_lt: $xLt, y_lte: $yLte, y_gt: $yGt }\n\t\t) {\n\t\t\tid\n\t\t\t# tokenId\n\t\t\towner {\n\t\t\t\taddress\n\t\t\t}\n\t\t\tx\n\t\t\ty\n\t\t\t# data {\n\t\t\t# \tname\n\t\t\t# \tdescription\n\t\t\t# \tipns\n\t\t\t# }\n\t\t\testate {\n\t\t\t\t# id\n\t\t\t\t# tokenId\n\t\t\t\towner {\n\t\t\t\t\taddress\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n"])));function j(t,e){return{x:t-t%f.ParcelBlockWidth,y:e-e%f.ParcelBlockWidth}}function m(t,e,n){return null===t||void 0===t?void 0:t.parcels.find((function(t){return parseInt(t.x)===e&&parseInt(t.y)===n}))}var O=n(16),k=function(t,e,n,r){var a=j(t,e);window.getBlockCoordinate=j;var i,c={first:f.ParcelsPerQuery,xGte:a.x,xLt:a.x+f.ParcelBlockWidth,yLte:a.y,yGt:a.y-f.ParcelBlockWidth},u="".concat(a.x,",").concat(a.y);return u in r?i=r[u]:(i=n.query({query:P,errorPolicy:"all",variables:c}),r[u]=i),i},E=function(t){var e=t.size,n=t.origin,r=t.parcelSize,a=t.selectedParcel,i=t.setSelectedParcel,c=u.a.useRef(null),s=u.a.useRef(n),o=u.a.useRef(r),f=u.a.useRef(a),h=u.a.useRef(i);u.a.useEffect((function(){s.current=n}),[n]),u.a.useEffect((function(){o.current=r}),[r]),u.a.useEffect((function(){f.current=a}),[a]),u.a.useEffect((function(){h.current=i}),[i]);var w=u.a.useState(null),v=Object(l.a)(w,2),g=v[0],p=v[1],y=Object(x.a)(),b={},P=u.a.useCallback((function(){if(null!==c.current&&null!==g){var t=c.current,n=t.width,a=t.height;g.clearRect(0,0,n,a);for(var i=Math.ceil(e.height/r),u=Math.ceil(e.width/r),d=function(t){for(var e=function(e){var n=e+s.current.x,r=s.current.y-t,a=s.current,i=o.current;k(n,r,y,b).then((function(c){var u=c.data,d=c.error,h=c.loading;if(JSON.stringify(a)===JSON.stringify(s.current)&&i===o.current){var w,v,p=[0,0,0,255];if(h)p=[248,248,255,.4];else if(d)p=[240,128,128,.4];else if(w=m(u||{parcels:[]},n,r)){var x=(f.current,"0x9a6ebe7e2a7722f8200d0ffb63a1f6406a0d7dce"===(v=function(t){return(t.estate?t.estate:t).owner.address}(w))?[0,0,0,255]:(v=v.slice(2),[parseInt(v.slice(0,12),16)%256,parseInt(v.slice(12,24),16)%256,parseInt(v.slice(24,36),16)%256,255])),y=Object(l.a)(x,4),b=y[0],P=y[1],j=y[2],O=y[3];b/=256,P/=256,j/=256;var k=1-function(t,e){return e&&!1===function(t,e){var n;if(e.estate||t.estate){if(e.estate&&t.estate){if(e.estate.owner.address===t.estate.owner.address)return!0}else if(e.estate){if(e.estate.owner.address===t.owner.address)return!0}else if(e.owner.address===(null===(n=t.estate)||void 0===n?void 0:n.owner.address))return!0}else if(t.owner.address===e.owner.address)return!0;return!1}(t,e)?.05:1}(w,f.current),E=.3*b+.6*P+.1*j;p=[256*(b+k*(E-b)),256*(P+k*(E-P)),256*(j+k*(E-j)),O]}var L=o.current,S=e*L,I=t*L;g.fillStyle="rgba(".concat(p.join(","),")"),g.fillRect(S,I,L,L)}}))},n=0;n<u;n++)e(n)},h=0;h<i;h++)d(h)}}),[g,e,o.current,s.current,f.current]),j=u.a.useRef(P);u.a.useEffect((function(){j.current=P}),[P]);var E=u.a.useCallback((function(t){var e=t.pageX-t.currentTarget.offsetLeft,n=t.pageY-t.currentTarget.offsetTop,a=Math.floor(e/r),i=Math.floor(n/r),c=a+s.current.x,u=s.current.y-i,l=s.current,d=o.current;k(c,u,y,b).then((function(t){if(JSON.stringify(l)===JSON.stringify(s.current)&&d===o.current){var e=t.data,n=(t.error,t.loading,m(e||{parcels:[]},c,u));n?h.current(n):h.current(null),window.setTimeout((function(){j.current()}))}}))}),[c.current,s.current,o.current,f.current]);return u.a.useEffect((function(){var t,e=c.current;null===e?p(null):(t=e.getContext("2d",{desynchronized:!1,willReadFrequently:!1}),p(t))}),[c.current,p]),u.a.useEffect(P,[g,e,o.current,s.current]),Object(O.jsx)("nav",{className:"CanvasParcelGrid","data-testid":"CanvasParcelGrid",children:Object(O.jsx)("canvas",{ref:c,width:e.width,height:e.height,onMouseMove:function(t){return E(t)},className:Object(d.a)({position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:-1,backgroundColor:"black",width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),"&:hover":{cursor:"pointer"}})})})};n(58);var L=function(){var t=h(),e=v(f.ParcelPixelWidth,{delta:1,minValue:f.ParcelPixelMinWidth,maxValue:f.ParcelPixelMaxWidth}),n=p(f.Origin),r=u.a.useState(null),a=Object(l.a)(r,2),i=a[0],c=a[1];return Object(O.jsx)("main",{className:Object(d.a)({color:"white"}),children:Object(O.jsx)(E,{size:t,origin:n,parcelSize:e,selectedParcel:i,setSelectedParcel:c})})},S=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,74)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,i=e.getLCP,c=e.getTTFB;n(t),r(t),a(t),i(t),c(t)}))},I=n(39),M=n.n(I),W=n(41),B=n(72),C=n(70),R=n(69);function $(){return z.apply(this,arguments)}function z(){return(z=Object(i.a)(a.a.mark((function t(){var e,n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new B.a({typePolicies:{Parcel:{keyFields:["x","y"]}}}),M.a.config({name:"metestates",storeName:"keyvaluepairs",description:"Local storage for the Metestates web app."}),t.next=4,Object(W.b)({cache:e,maxSize:!1,storage:new W.a(M.a)});case 4:return n=new C.a({uri:"https://api.thegraph.com/subgraphs/name/decentraland/marketplace",cache:e}),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function G(){return(G=Object(i.a)(a.a.mark((function t(){var e;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$();case 2:e=t.sent,o.a.render(Object(O.jsx)(u.a.StrictMode,{children:Object(O.jsx)(R.a,{client:e,children:Object(O.jsx)(L,{})})}),document.getElementById("root")),S();case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){G.apply(this,arguments)}()}},[[59,1,2]]]);
//# sourceMappingURL=main.a822a32a.chunk.js.map