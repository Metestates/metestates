(this.webpackJsonpmetestates=this.webpackJsonpmetestates||[]).push([[0],{138:function(e,t,n){},167:function(e,t,n){},175:function(e,t){},186:function(e,t,n){},187:function(e,t,n){},188:function(e,t,n){"use strict";n.r(t);var r=n(34),a=n(2),c=n.n(a),i=n(21),s=n(5),o=n.n(s),u=n(144),l=n.n(u),d=n(121),f=n.n(d),h=n(130),v=n(217),w=n(215),b=n(213),x=n(132),j=n(214),g=(n(167),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,222)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))}),p=n(11),O=n(154),y={ParcelPixelWidth:16,ParcelPixelMinWidth:4,ParcelPixelMaxWidth:80,ParcelBlockWidth:30,ParcelsPerQuery:900,Origin:{x:-0,y:0},PanningStep:1},m=function(){var e=s.useState({width:window.innerWidth,height:window.innerHeight}),t=Object(p.a)(e,2),n=t[0],r=t[1];return s.useEffect((function(){function e(){r({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[window.innerWidth,window.innerHeight]),n};function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return Math.max(t||-1/0,Math.min(e,n||1/0))}var k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{delta:1},n=s.useState(e),r=Object(p.a)(n,2),a=r[0],c=r[1];return s.useEffect((function(){function e(e){var n=P(a+(e.deltaY<0?-1*t.delta:t.delta),t.minValue,t.maxValue);c(n)}return window.addEventListener("wheel",e),function(){window.removeEventListener("wheel",e)}}),[a,c]),a};var E,C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},t=s.useState(e),n=Object(p.a)(t,2),r=n[0],a=n[1];return s.useEffect((function(){function e(e){var t=y.PanningStep,n={x:0,y:0};switch(e.key){case"ArrowUp":n.y=t;break;case"ArrowDown":n.y=-t;break;case"ArrowLeft":n.x=-t;break;case"ArrowRight":n.x=t}a({x:r.x+n.x,y:r.y+n.y})}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[r,a]),r},L=(n(138),n(54)),S=n(122),M=n.n(S),W=n(70),B=n(218),I=n(206),N=function(e,t){var n;if(n=Object(B.a)(t&&{contract:new W.a(e,I.a),method:"balanceOf",args:[t]}),!t)return[void 0,void 0,!0];if(!n)return[void 0,void 0,!1];var r=n,a=r.value,c=r.error;return c?[void 0,c,!1]:[a.balance,void 0,!1]},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e.length<11)return e;var t=[e.slice(0,5),e.slice(-4)],n=t[0],r=t[1];return"".concat(n,"\u2026").concat(r)},$=n(12),z=function(e){var t=e.token,n=e.address,r=N(t.address,n),a=Object(p.a)(r,3),c=a[0],i=a[1];if(a[2]||!c&&!i)return Object($.jsx)("div",{children:Object($.jsx)("p",{children:"Loading\u2026"})});if(i)return Object($.jsx)("div",{children:Object($.jsxs)("p",{children:["Error retreiving token balance: ",i]})});var s=Object(L.formatUnits)(c,t.decimals);return Object($.jsx)("div",{className:"TokenBalance",children:Object($.jsxs)("div",{className:"wrapper",children:[Object($.jsx)("div",{className:"left",children:Object($.jsx)(M.a,{diameter:40,seed:Object(S.jsNumberForAddress)(n)})}),Object($.jsxs)("div",{className:"right",children:[Object($.jsx)("span",{children:R(n)}),c&&Object($.jsxs)("span",{children:[s," ",t.symbol]})]})]})})},A=n(219),G=(n(186),function(){var e=Object(O.a)().activateBrowserWallet,t=Object(A.a)().notifications,n=o.a.useCallback((function(){e().then((function(){console.log("Connected to a new browser wallet\u2026")}))}),[e]);return o.a.useEffect((function(){t.map((function(e){switch(e.type){case"walletConnected":var t=e.address;console.log("Connected to wallet with address ".concat(t,"."));break;default:console.log(e)}}))}),[t]),Object($.jsx)("button",{className:"ConnectToWalletButton",onClick:function(e){return n()},children:"Connect Wallet"})}),T=n(207),F=n(153),J=n(150),_=n(216),q=Object(_.a)(E||(E=Object(J.a)(["\n\tquery GET_PARCEL_BLOCK(\n\t\t$first: Int,\n\t\t$xGte: BigInt\n\t\t$xLt: BigInt\n\t\t$yLte: BigInt\n\t\t$yGt: BigInt\n\t) {\n\t\tparcels(\n\t\t\tfirst: $first,\n\t\t\twhere: { x_gte: $xGte, x_lt: $xLt, y_lte: $yLte, y_gt: $yGt }\n\t\t) {\n\t\t\tid\n\t\t\t# tokenId\n\t\t\towner {\n\t\t\t\taddress\n\t\t\t}\n\t\t\tx\n\t\t\ty\n\t\t\t# data {\n\t\t\t# \tname\n\t\t\t# \tdescription\n\t\t\t# \tipns\n\t\t\t# }\n\t\t\testate {\n\t\t\t\t# id\n\t\t\t\t# tokenId\n\t\t\t\towner {\n\t\t\t\t\taddress\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n"])));function V(e,t){return{x:e-e%y.ParcelBlockWidth,y:t-t%y.ParcelBlockWidth}}function D(e,t,n){return null===e||void 0===e?void 0:e.parcels.find((function(e){return parseInt(e.x)===t&&parseInt(e.y)===n}))}var H=function(e,t,n,r){var a=V(e,t);window.getBlockCoordinate=V;var c,i={first:y.ParcelsPerQuery,xGte:a.x,xLt:a.x+y.ParcelBlockWidth,yLte:a.y,yGt:a.y-y.ParcelBlockWidth},s="".concat(a.x,",").concat(a.y);return s in r?c=r[s]:(c=n.query({query:q,errorPolicy:"all",variables:i}),r[s]=c),c},U=function(e){var t=e.size,n=e.origin,r=e.parcelSize,a=e.selectedParcel,c=e.setSelectedParcel,i=o.a.useRef(null),s=o.a.useRef(n),u=o.a.useRef(r),l=o.a.useRef(a),d=o.a.useRef(c);o.a.useEffect((function(){s.current=n}),[n]),o.a.useEffect((function(){u.current=r}),[r]),o.a.useEffect((function(){l.current=a}),[a]),o.a.useEffect((function(){d.current=c}),[c]);var f=o.a.useState(null),h=Object(p.a)(f,2),v=h[0],w=h[1],b=Object(T.a)(),x={},j=o.a.useCallback((function(){if(null!==i.current&&null!==v){var e=i.current,n=e.width,a=e.height;v.clearRect(0,0,n,a);for(var c=Math.ceil(t.height/r),o=Math.ceil(t.width/r),d=function(e){for(var t=function(t){var n=t+s.current.x,r=s.current.y-e,a=s.current,c=u.current;H(n,r,b,x).then((function(i){var o=i.data,d=i.error,f=i.loading;if(JSON.stringify(a)===JSON.stringify(s.current)&&c===u.current){var h,w,b=[0,0,0,255];if(f)b=[248,248,255,.4];else if(d)b=[240,128,128,.4];else if(h=D(o||{parcels:[]},n,r)){var x=(l.current,"0x9a6ebe7e2a7722f8200d0ffb63a1f6406a0d7dce"===(w=function(e){return(e.estate?e.estate:e).owner.address}(h))?[0,0,0,255]:(w=w.slice(2),[parseInt(w.slice(0,12),16)%256,parseInt(w.slice(12,24),16)%256,parseInt(w.slice(24,36),16)%256,255])),j=Object(p.a)(x,4),g=j[0],O=j[1],y=j[2],m=j[3];g/=256,O/=256,y/=256;var P=1-function(e,t){return t&&!1===function(e,t){var n;if(t.estate||e.estate){if(t.estate&&e.estate){if(t.estate.owner.address===e.estate.owner.address)return!0}else if(t.estate){if(t.estate.owner.address===e.owner.address)return!0}else if(t.owner.address===(null===(n=e.estate)||void 0===n?void 0:n.owner.address))return!0}else if(e.owner.address===t.owner.address)return!0;return!1}(e,t)?.05:1}(h,l.current),k=.3*g+.6*O+.1*y;b=[256*(g+P*(k-g)),256*(O+P*(k-O)),256*(y+P*(k-y)),m]}var E=u.current,C=t*E,L=e*E;v.fillStyle="rgba(".concat(b.join(","),")"),v.fillRect(C,L,E,E)}}))},n=0;n<o;n++)t(n)},f=0;f<c;f++)d(f)}}),[v,t,u.current,s.current,l.current]),g=o.a.useRef(j);o.a.useEffect((function(){g.current=j}),[j]);var O=o.a.useCallback((function(e){var t=e.pageX-e.currentTarget.offsetLeft,n=e.pageY-e.currentTarget.offsetTop,a=Math.floor(t/r),c=Math.floor(n/r),i=a+s.current.x,o=s.current.y-c,l=s.current,f=u.current;H(i,o,b,x).then((function(e){if(JSON.stringify(l)===JSON.stringify(s.current)&&f===u.current){var t=e.data,n=(e.error,e.loading,D(t||{parcels:[]},i,o));n?d.current(n):d.current(null),window.setTimeout((function(){g.current()}))}}))}),[i.current,s.current,u.current,l.current]);return o.a.useEffect((function(){var e,t=i.current;null===t?w(null):(e=t.getContext("2d",{desynchronized:!1,willReadFrequently:!1}),w(e))}),[i.current,w]),o.a.useEffect(j,[v,t,u.current,s.current]),Object($.jsx)("nav",{className:"CanvasParcelGrid","data-testid":"CanvasParcelGrid",children:Object($.jsx)("canvas",{ref:i,width:t.width,height:t.height,onMouseMove:function(e){return O(e)},className:Object(F.a)({position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:-1,backgroundColor:"black",width:"".concat(t.width,"px"),height:"".concat(t.height,"px"),"&:hover":{cursor:"pointer"}})})})};n(187);var Q=function(){var e=m(),t=k(y.ParcelPixelWidth,{delta:1,minValue:y.ParcelPixelMinWidth,maxValue:y.ParcelPixelMaxWidth}),n=C(y.Origin),r=o.a.useState(null),a=Object(p.a)(r,2),c=a[0],i=a[1],s=Object(O.a)().account;return Object($.jsxs)("div",{className:"App",children:[Object($.jsxs)("header",{children:[!s&&Object($.jsx)(G,{}),s&&Object($.jsx)(z,{token:{name:"Decentraland",symbol:"MANA",address:"0x0f5d2fb29fb7d3cfee444a200298f468908cc942",decimals:18},address:s})]}),Object($.jsx)("main",{children:Object($.jsx)(U,{size:e,origin:n,parcelSize:t,selectedParcel:c,setSelectedParcel:i})})]})},Y=function(){var e=Object(i.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new v.a({typePolicies:{Parcel:{keyFields:["x","y"]}}}),f.a.config({name:"metestates",storeName:"keyvaluepairs",description:"Local storage for the Metestates web app."}),e.next=4,Object(h.b)({cache:t,maxSize:!1,storage:new h.a(f.a)});case 4:return n=new w.a({uri:"https://api.thegraph.com/subgraphs/name/decentraland/marketplace",cache:t}),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function K(){return(K=Object(i.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y();case 2:t=e.sent,n={readOnlyChainId:x.a.Mainnet,readOnlyUrls:Object(r.a)({},x.a.Mainnet,"https://mainnet.infura.io/v3/84842078b09946638c03157f83405213")},l.a.render(Object($.jsx)(o.a.StrictMode,{children:Object($.jsx)(b.a,{client:t,children:Object($.jsx)(j.a,{config:n,children:Object($.jsx)(Q,{})})})}),document.getElementById("root")),g();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){K.apply(this,arguments)}()}},[[188,1,2]]]);
//# sourceMappingURL=main.e465330c.chunk.js.map